{
  "tasks": [
    {
      "type": "shell",
      "label": "Create Build Folder",
      "command": "if (!(Test-Path 'build')) { New-Item -ItemType Directory -Path 'build' }",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "detail": "Create build folder if it doesn't exist"
    },
    {
      "type": "shell",
      "label": "Build for Arduino Uno",
      "command": "${workspaceFolder}\\toolchain\\avr8-gnu-toolchain-win32_x86_64\\bin\\avr-g++.exe",
      "args": [
        "-mmcu=atmega328p",
        "-DF_CPU=16000000UL",
        "-Os",
        "-Wall",
        "-Wextra",
        "-Isrc",
        "src\\controller.cpp",
        "src\\arduino_hal.cpp",
        "src\\motor_driver.cpp",
        "-o",
        "build\\controller.elf"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [
        "$gcc"
      ],
      "dependsOn": ["Create Build Folder"],
      "detail": "Build modular Arduino project for Uno (ATmega328P)"
    },
    {
      "type": "shell",
      "label": "Convert ELF to HEX (Arduino)",
      "command": "${workspaceFolder}\\toolchain\\avr8-gnu-toolchain-win32_x86_64\\bin\\avr-objcopy.exe",
      "args": [
        "-O",
        "ihex",
        "-R",
        ".eeprom",
        "build\\controller.elf",
        "build\\controller.hex"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "detail": "Convert ELF to Intel HEX format for Arduino upload"
    },
    {
      "type": "shell",
      "label": "Show Binary Size (Arduino)",
      "command": "${workspaceFolder}\\toolchain\\avr8-gnu-toolchain-win32_x86_64\\bin\\avr-size.exe",
      "args": [
        "build\\controller.elf"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "detail": "Display memory usage for Arduino Uno"
    },
    {
      "type": "shell",
      "label": "Build Complete Arduino Uno Project",
      "dependsOn": [
        "Build for Arduino Uno",
        "Convert ELF to HEX (Arduino)",
        "Show Binary Size (Arduino)"
      ],
      "dependsOrder": "sequence",
      "group": "build",
      "problemMatcher": [],
      "detail": "Build ELF and HEX files for Arduino Uno in build/ folder"
    },
    {
      "type": "shell",
      "label": "Build C++ Project",
      "command": "g++",
      "args": [
        "-g",
        "-Wall",
        "-std=c++11",
        "${file}",
        "-o",
        "${fileDirname}\\${fileBasenameNoExtension}.exe"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [
        "$gcc"
      ],
      "group": "build",
      "detail": "Build C++ files with g++ 7.4.0"
    },
    {
      "type": "cppbuild",
      "label": "C/C++: g++.exe build active file",
      "command": "C:\\_tools\\msys64\\mingw32\\bin\\g++.exe",
      "args": [
        "-fdiagnostics-color=always",
        "-g",
        "${file}",
        "-o",
        "${fileDirname}\\${fileBasenameNoExtension}.exe"
      ],
      "options": {
        "cwd": "${fileDirname}"
      },
      "problemMatcher": [
        "$gcc"
      ],
      "group": "build",
      "detail": "Task generated by Debugger."
    }
  ],
  "version": "2.0.0"
}